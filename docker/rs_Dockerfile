FROM ubuntu:16.04

ARG PROJECT_NAME="ai-bs-summer17"

############################################
# OpenAI Gym
############################################
RUN apt-get update --fix-missing \
    && apt-get install -y python-numpy python-dev cmake \
    zlib1g-dev libjpeg-dev xvfb libav-tools xorg-dev \
    python-opengl libboost-all-dev libsdl2-dev swig mlocate \
    python-pip

RUN pip install --upgrade pip
RUN pip install 'gym[all]'

############################################
# Deep Learning
############################################
RUN pip install tensorflow keras

############################################
# Roboschool
############################################
RUN apt-get update \
    && apt-get install -y git cmake ffmpeg pkg-config \
    qtbase5-dev libqt5opengl5-dev libassimp-dev \
    libpython3.5-dev libboost-python-dev libtinyxml-dev

# Create a local user account
RUN adduser docker
ENV HOME /home/docker
USER docker
WORKDIR ${HOME}

RUN git clone --depth 1 https://github.com/olegklimov/bullet3 -b roboschool_self_collision \
    && git clone --depth 1 https://github.com/openai/roboschool
# export ROBOSCHOOL_PATH=/root/roboschool
ENV ROBOSCHOOL_PATH ${HOME}/roboschool
RUN mkdir -p ${HOME}/bullet3/build \
    && cd ${HOME}/bullet3/build \
    && cmake -DBUILD_SHARED_LIBS=ON -DUSE_DOUBLE_PRECISION=1 \
       -DCMAKE_INSTALL_PREFIX:PATH=${ROBOSCHOOL_PATH}/roboschool/cpp-household/bullet_local_install \
       -DBUILD_CPU_DEMOS=OFF -DBUILD_BULLET2_DEMOS=OFF \
       -DBUILD_EXTRAS=OFF  -DBUILD_UNIT_TESTS=OFF \
       -DBUILD_CLSOCKET=OFF -DBUILD_ENET=OFF \
       -DBUILD_OPENGL3_DEMOS=OFF .. \
    && make \
    && make install

USER root
RUN pip install --no-cache-dir -e ${ROBOSCHOOL_PATH}

